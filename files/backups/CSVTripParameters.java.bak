import java.io.File;
import java.io.FileReader;
import java.io.BufferedReader;
import java.io.IOException;

class CSVTripParameters implements CSVParsable
{
	private File inputFile;
	
	CSVTripParameters(File inputFile)
	{
		this.inputFile = inputFile;
	}
	
	public TripParameters getData(boolean omitFirstLine) throws CSVInputException
	{
		String line;
		String[] parts;
		double initialHeading;
		double initialSpeed;
	
		try(BufferedReader bufferedReader = new BufferedReader(new FileReader(inputFile))){
			try{
				if(omitFirstLine){
					bufferedReader.readLine(); // throws IOException
				}
				line = bufferedReader.readLine(); // throws IOException
				line = line.replaceAll("\\s+", ""); // eat whitespace. This throws PatternSyntaxException, impossible here
				parts = line.split(","); // throws PatternSyntaxException, impossible here
				initialHeading = Double.parseDouble(parts[0]); // throws NumberFormatException (quite possible), ArrayIndexOutOfBoundsException (quite possible), NullPointerException (impossible: AIOoBE will be thrown before NPE)
				initialSpeed = Double.parseDouble(parts[1]); // throws NumberFormatException (quite possible), ArrayIndexOutOfBoundsException (quite possible), NullPointerException (impossible: AIOoBE will be thrown before NPE)
				if(initialSpeed < 0) throw new NegativeNumberException("Speed cannot be negative.");
			} catch(NegativeNumberException nne){
				throw new CSVInputException("Invalid value.", nne);
			} catch(ArrayIndexOutOfBoundsException bex){
				throw new CSVInputException("Fields could be missing from the file, be situated in a wrong line, or perhaps a wrong delimiter is used.", bex);
			} catch(NullPointerException | IllegalArgumentException rte){
				throw new CSVInputException("Bad input.", rte);
			}
			return new TripParameters(initialHeading, initialSpeed);
		} catch(IOException ioex){
			throw new CSVInputException("I/O error.", ioex);
		}
	}
}